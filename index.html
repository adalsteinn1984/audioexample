<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Mixer</title>
</head>

<style>
    body {
        background-color: black;
        color: white;
        font-family: 'Courier New', Courier, monospace;
    }

    .channel {
        margin: 16px;
        display: flex;
        flex-direction: row;
    }

    .play {
        margin: 16px;
    }

    .lbl {
        min-width: 200px;
    }
</style>

<body>

    <div>

        <h1 style="padding: 16px">Audio experiment</h1>

        <div class="channel">
            <div class="lbl" for="channelA">Channel A (Kick):</div>
            <select id="channelA" onchange="changeVariation('a', this.value)">
                <option value="1">Variation 1 - 4th part notes</option>
                <option value="2">Variation 2 - 8th part notes</option>
                <option value="3">Variation 3 - 16th part notes</option>
            </select>
        </div>

        <div class="channel">
            <div class="lbl" for="channelB">Channel B (Snare):</div>
            <select id="channelB" onchange="changeVariation('b', this.value)">
                <option value="1">Variation 1 - 4th part notes</option>
                <option value="2">Variation 2 - 8th part notes</option>
                <option value="3">Variation 3 - 16th part notes</option>
            </select>
        </div>

        <div class="channel">
            <div class="lbl" for="channelC">Channel C (Hihat):</div>
            <select id="channelC" onchange="changeVariation('c', this.value)">
                <option value="1">Variation 1 - 4th part notes</option>
                <option value="2">Variation 2 - 8th part notes</option>
                <option value="3">Variation 3 - 16th part notes</option>
            </select>
        </div>

        <div class="channel">
            <div class="lbl" for="channelD">Channel D (Tom):</div>
            <select id="channelD" onchange="changeVariation('d', this.value)">
                <option value="1">Variation 1 - 4th part notes</option>
                <option value="2">Variation 2 - 8th part notes</option>
                <option value="3">Variation 3 -16th part notes</option>
            </select>
        </div>


        <button class="play" onclick="playAllChannels()">Play</button>

        <br>

        <pre class="play">
In this example there are 4 channels.
Each channel has 3 variations.
So there are in total 81 variations (3*3*3*3)

This example shows a simple drum loop to demonstrate that everything is in sync. 

There are 12 audio stems:
a1.wav	a2.wav	a3.wav	b1.wav	b2.wav	b3.wav	c1.wav	c2.wav	c3.wav	d1.wav	d2.wav	d3.wav

There are 81 possible outcomes:
a1b1c1d1.wav[1] a1b1c3d1.wav[2] a1b2c2d1.wav[3] a1b3c1d1.wav[4] a1b3c3d1.wav[5] a2b1c2d1.wav[6] a2b2c1d1.wav[7] a2b2c3d1.wav[8] a2b3c2d1.wav[9] a3b1c1d1.wav[10] a3b1c3d1.wav[11] a3b2c2d1.wav[12] a3b3c1d1.wav[13] a3b3c3d1.wav[14]
a1b1c1d2.wav[15] a1b1c3d2.wav[16] a1b2c2d2.wav[17] a1b3c1d2.wav[18] a1b3c3d2.wav[19] a2b1c2d2.wav[20] a2b2c1d2.wav[21] a2b2c3d2.wav[22] a2b3c2d2.wav[23] a3b1c1d2.wav[24] a3b1c3d2.wav[25] a3b2c2d2.wav[26] a3b3c1d2.wav[27] a3b3c3d2.wav[28]
a1b1c1d3.wav[29] a1b1c3d3.wav[30] a1b2c2d3.wav[31] a1b3c1d3.wav[32] a1b3c3d3.wav[33] a2b1c2d3.wav[34] a2b2c1d3.wav[35] a2b2c3d3.wav[36] a2b3c2d3.wav[37] a3b1c1d3.wav[38] a3b1c3d3.wav[39] a3b2c2d3.wav[40] a3b3c1d3.wav[41] a3b3c3d3.wav[42]
a1b1c2d1.wav[43] a1b2c1d1.wav[44] a1b2c3d1.wav[45] a1b3c2d1.wav[46] a2b1c1d1.wav[47] a2b1c3d1.wav[48] a2b2c2d1.wav[49] a2b3c1d1.wav[50] a2b3c3d1.wav[51] a3b1c2d1.wav[52] a3b2c1d1.wav[53] a3b2c3d1.wav[54] a3b3c2d1.wav[55]
a1b1c2d2.wav[56] a1b2c1d2.wav[57] a1b2c3d2.wav[58] a1b3c2d2.wav[59] a2b1c1d2.wav[60] a2b1c3d2.wav[61] a2b2c2d2.wav[62] a2b3c1d2.wav[63] a2b3c3d2.wav[64] a3b1c2d2.wav[65] a3b2c1d2.wav[66] a3b2c3d2.wav[67] a3b3c2d2.wav[68]
a1b1c2d3.wav[69] a1b2c1d3.wav[70] a1b2c3d3.wav[71] a1b3c2d3.wav[72] a2b1c1d3.wav[73] a2b1c3d3.wav[74] a2b2c2d3.wav[75] a2b3c1d3.wav[76] a2b3c3d3.wav[77] a3b1c2d3.wav[78] a3b2c1d3.wav[79] a3b2c3d3.wav[80] a3b3c2d3.wav[81]

The number in the square bracket would be the number of each NFT. So there would be 81 NFTs in total. 
I mixed all possible combinations using a terminal command called ffmpeg so mixing the final stems would follow the same process.

All those WAV files would be added to IPFS or simlar and a simple NFT contract would be used for minting.

    </pre>


        <script>
            // Initialize Web Audio API
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();

            // Load audio files
            const audioFiles = {
                a1: 'a1.wav',
                a2: 'a2.wav',
                a3: 'a3.wav',
                b1: 'b1.wav',
                b2: 'b2.wav',
                b3: 'b3.wav',
                c1: 'c1.wav',
                c2: 'c2.wav',
                c3: 'c3.wav',
                d1: 'd1.wav',
                d2: 'd2.wav',
                d3: 'd3.wav'
            };

            // Create audio buffers
            const buffers = {};

            async function loadAudioBuffer(file) {
                const response = await fetch(file);
                const arrayBuffer = await response.arrayBuffer();
                return await audioContext.decodeAudioData(arrayBuffer);
            }

            async function loadAudioBuffers() {
                for (const key in audioFiles) {
                    buffers[key] = await loadAudioBuffer("/audio/" + audioFiles[key]);
                }
            }

            loadAudioBuffers();

            // Create audio sources and gain nodes
            const sources = {};
            const gains = {};
            let settings = {
                a: 1,
                b: 1,
                c: 1,
                d: 1
            };

            function createSource(channel, variation) {
                const key = channel + variation;
                sources[key] = audioContext.createBufferSource();
                sources[key].buffer = buffers[key];
                gains[key] = audioContext.createGain();
                sources[key].connect(gains[key]);
                gains[key].connect(audioContext.destination);
            }

            let isPlaying = false;

            // Change variation function
            function changeVariation(channel, v) {
                console.log('changeVariation', channel, v)
                settings[channel] = v;

                variation = settings[channel];

                if (!isPlaying) return;

                const key = channel + variation;

                // Stop the current source
                if (sources[channel]) {
                    sources[channel].stop();
                    sources[channel].disconnect();
                }

                // Create and start a new source
                createSource(channel, variation);

                // Set the new source's playback time
                const currentTime = audioContext.currentTime;
                const elapsedTime = currentTime % sources[key].buffer.duration;
                const offset = currentTime - elapsedTime;

                console.log('elapsedTime', elapsedTime)

                sources[key].start(0, elapsedTime);
            }

            // Play all channels function
            function playAllChannels() {
                isPlaying = true;

                // Initialize all channels with variation 1 and play
                for (const channel of ['a', 'b', 'c', 'd']) {
                    // console.log(channel)
                    console.log('>>', settings[channel]);
                    changeVariation(channel, settings[channel]);
                }
            }
        </script>

    </div>
</body>

</html>
